<!-- Cabin Finder Page -->
<main class="cabin-finder">

  <!-- Hero Section -->
  <section class="finder-hero">
    <div class="finder-hero__container">
      <h1 class="finder-hero__title">Find Your Perfect Cabin</h1>
      <p class="finder-hero__description">
        Use our advanced filters to discover the ideal cabin for your needs
      </p>
    </div>
  </section>

  <!-- Main Content -->
  <section class="finder-content">
    <div class="finder-content__container">

      <!-- Filters Sidebar -->
      <aside class="filters-panel">
        <div class="filters-panel__header">
          <h2 class="filters-panel__title">
            Filters
            <span class="filters-panel__count" *ngIf="activeFiltersCount > 0">
              ({{ activeFiltersCount }})
            </span>
          </h2>
          <button 
            class="filters-panel__clear"
            *ngIf="activeFiltersCount > 0"
            (click)="clearFilters()"
          >
            Clear All
          </button>
        </div>

        <!-- Size Filter -->
        <div class="filter-group">
          <h3 class="filter-group__title">Size</h3>
          <div class="filter-group__options">
            <label 
              class="radio-option"
              *ngFor="let option of sizeOptions"
            >
              <input 
                type="radio" 
                name="size"
                [value]="option.value"
                [(ngModel)]="selectedSize"
                (change)="applyFilters()"
                class="radio-option__input"
              />
              <span class="radio-option__label">{{ option.label }}</span>
            </label>
          </div>
        </div>

        <!-- Style Filter -->
        <div class="filter-group">
          <h3 class="filter-group__title">Style</h3>
          <div class="filter-group__options">
            <label 
              class="radio-option"
              *ngFor="let option of styleOptions"
            >
              <input 
                type="radio" 
                name="style"
                [value]="option.value"
                [(ngModel)]="selectedStyle"
                (change)="applyFilters()"
                class="radio-option__input"
              />
              <span class="radio-option__label">{{ option.label }}</span>
            </label>
          </div>
        </div>

        <!-- Price Range Filter -->
        <div class="filter-group">
          <h3 class="filter-group__title">Price Range</h3>
          <div class="filter-group__options">
            <label 
              class="radio-option"
              *ngFor="let option of priceOptions"
            >
              <input 
                type="radio" 
                name="price"
                [value]="option.value"
                [(ngModel)]="selectedPriceRange"
                (change)="applyFilters()"
                class="radio-option__input"
              />
              <span class="radio-option__label">{{ option.label }}</span>
            </label>
          </div>
        </div>

        <!-- Eco-Friendly Toggle -->
        <div class="filter-group">
          <label class="checkbox-option">
            <input 
              type="checkbox"
              [(ngModel)]="ecoFriendlyOnly"
              (change)="applyFilters()"
              class="checkbox-option__input"
            />
            <span class="checkbox-option__label">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
              </svg>
              Eco-Friendly Only
            </span>
          </label>
        </div>

        <!-- Features Filter -->
        <div class="filter-group">
          <h3 class="filter-group__title">Features</h3>
          <div class="filter-group__options">
            <label 
              class="checkbox-option"
              *ngFor="let feature of availableFeatures"
            >
              <input 
                type="checkbox"
                [checked]="isFeatureSelected(feature)"
                (change)="toggleFeature(feature)"
                class="checkbox-option__input"
              />
              <span class="checkbox-option__label">{{ feature }}</span>
            </label>
          </div>
        </div>
      </aside>

      <!-- Results Section -->
      <div class="results-section">

        <!-- Toolbar -->
        <div class="results-toolbar">
          <div class="results-toolbar__info">
            <p class="results-count">
              <strong>{{ filteredProducts.length }}</strong> cabin{{ filteredProducts.length !== 1 ? 's' : '' }} found
            </p>
          </div>

          <div class="results-toolbar__controls">
            <!-- Sort -->
            <select 
              class="sort-select"
              [(ngModel)]="sortBy"
              (change)="applyFilters()"
            >
              <option value="name">Sort: Name</option>
              <option value="price-asc">Sort: Price (Low-High)</option>
              <option value="price-desc">Sort: Price (High-Low)</option>
              <option value="rating">Sort: Rating</option>
              <option value="size">Sort: Size</option>
            </select>

            <!-- View Toggle -->
            <div class="view-toggle">
              <button 
                class="view-toggle__btn"
                [class.view-toggle__btn--active]="viewMode === 'grid'"
                (click)="viewMode = 'grid'"
                aria-label="Grid view"
              >
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                  <rect x="3" y="3" width="7" height="7" stroke-width="2"/>
                  <rect x="14" y="3" width="7" height="7" stroke-width="2"/>
                  <rect x="14" y="14" width="7" height="7" stroke-width="2"/>
                  <rect x="3" y="14" width="7" height="7" stroke-width="2"/>
                </svg>
              </button>
              <button 
                class="view-toggle__btn"
                [class.view-toggle__btn--active]="viewMode === 'list'"
                (click)="viewMode = 'list'"
                aria-label="List view"
              >
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                  <line x1="8" y1="6" x2="21" y2="6" stroke-width="2" stroke-linecap="round"/>
                  <line x1="8" y1="12" x2="21" y2="12" stroke-width="2" stroke-linecap="round"/>
                  <line x1="8" y1="18" x2="21" y2="18" stroke-width="2" stroke-linecap="round"/>
                  <line x1="3" y1="6" x2="3.01" y2="6" stroke-width="2" stroke-linecap="round"/>
                  <line x1="3" y1="12" x2="3.01" y2="12" stroke-width="2" stroke-linecap="round"/>
                  <line x1="3" y1="18" x2="3.01" y2="18" stroke-width="2" stroke-linecap="round"/>
                </svg>
              </button>
            </div>
          </div>
        </div>

        <!-- Comparison Bar -->
        <div class="comparison-bar" *ngIf="comparisonCount > 0">
          <div class="comparison-bar__content">
            <div class="comparison-bar__info">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
              </svg>
              <span>{{ comparisonCount }} / {{ comparisonService.getMaxItems() }} cabins selected for comparison</span>
            </div>
            <div class="comparison-bar__actions">
              <a class="button button--primary button--small" routerLink="/comparison">
                Compare Now
              </a>
              <button class="button button--secondary button--small" (click)="clearComparison()">
                Clear
              </button>
            </div>
          </div>
        </div>

        <!-- Products Grid/List -->
        <div 
          class="products-container"
          [class.products-container--grid]="viewMode === 'grid'"
          [class.products-container--list]="viewMode === 'list'"
        >
          <article 
            class="product-item"
            *ngFor="let product of filteredProducts"
            [class.product-item--in-comparison]="isInComparison(product.id)"
          >
            <!-- Product Image -->
            <div class="product-item__image">
              <img [src]="product.image" [alt]="product.name" loading="lazy">
              <div class="product-item__badge">{{ product.category }}</div>
              
              <!-- Comparison Toggle -->
              <button 
                class="product-item__compare-btn"
                [class.product-item__compare-btn--active]="isInComparison(product.id)"
                (click)="isInComparison(product.id) ? removeFromComparison(product.id) : addToComparison(product)"
                [disabled]="!canAddToComparison() && !isInComparison(product.id)"
                [attr.aria-label]="isInComparison(product.id) ? 'Remove from comparison' : 'Add to comparison'"
              >
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                </svg>
              </button>
            </div>

            <!-- Product Info -->
            <div class="product-item__content">
              <h3 class="product-item__title">{{ product.name }}</h3>
              
              <div class="product-item__rating">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                </svg>
                <span>{{ product.rating }}</span>
                <span class="product-item__reviews">({{ product.reviews }})</span>
              </div>

              <p class="product-item__description">{{ product.description }}</p>

              <div class="product-item__meta">
                <div class="meta-item">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"/>
                  </svg>
                  <span>{{ product.size }}</span>
                </div>
                <div class="meta-item" *ngIf="product.inStock">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                  </svg>
                  <span>In Stock</span>
                </div>
              </div>

              <div class="product-item__features">
                <span 
                  class="feature-tag"
                  *ngFor="let feature of product.features.slice(0, 3)"
                >
                  {{ feature }}
                </span>
              </div>

              <div class="product-item__footer">
                <div class="product-item__price">
                  â‚¦{{ product.price.toLocaleString() }}
                </div>
                <div class="product-item__actions">
                  <a 
                    class="button button--secondary button--small"
                    [routerLink]="['/product', product.id]"
                  >
                    View Details
                  </a>
                  <button 
                    class="button button--primary button--small"
                    (click)="addToCart(product)"
                    [disabled]="!product.inStock"
                  >
                    Add to Cart
                  </button>
                </div>
              </div>
            </div>
          </article>
        </div>

        <!-- No Results -->
        <div class="no-results" *ngIf="filteredProducts.length === 0">
          <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
          </svg>
          <h3 class="no-results__title">No cabins found</h3>
          <p class="no-results__description">
            Try adjusting your filters to see more results
          </p>
          <button class="button button--primary" (click)="clearFilters()">
            Clear All Filters
          </button>
        </div>

      </div>

    </div>
  </section>

</main>
